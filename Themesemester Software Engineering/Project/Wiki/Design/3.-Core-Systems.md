#

Rabbit contains several vital core systems. They are responsible for key features, and almost every user story interacts with these systems. Because everyone works with them, documenting said systems is very important. They are not features themselves, but they enable other features to be built upon them.

These core systems were implemented as soon as possible, because everyone has to use them.

| # | Name | Brief Description/Usage | Status |
|-|-|-|-|
| 1 | GES | Global Event System | Complete |
| 2 | DSI | Dynamic Search Index | Complete |
| 3 | SPS | Scoped Permission System | Dropped |
| 4 | TSS | Task Scheduling System | Complete |
| 5 | GMD | Global Mail Dispatcher | Complete |
| 6 | CDN | Content Delivery Network | Complete |
| 7 | RTD | Real Time Delivery | WIP |

#### GES

This is the global event bus. Because almost every interaction (like posting and Praising) has side-effects, we needed a proper way of handling these. Every class has a list of functions that execute when certain events happen and/or conditions are met. Some use cases include:

- A Hopper Praises a post. This post has now reached the achievement threshold. The original poster receives the new achievement and a notification.
- A Keeper deletes a post. The original poster receives a notification, and linked Reputation is deducted.
- A Hopper logs into his account. Said Hopper receives an e-mail containing this notification (new/suspicious login detected, is it you?).

It also has a validating role, here are some examples:

- A Hopper tries to post inside a Burrow, but is blocked by a Keeper. The Hopper cannot post.
- A Hopper tries to post a comment on a post, but the post is made inside of a Burrow where the user is blocked. The Hopper cannot comment.
	- The same goes for Praising. No interaction with this Burrow is permitted.
- A Hoppers tries to post a comment on a post, but has an unverified account. The Hopper gets notified by this requirement, and cannot comment until they verify their account.

To keep everything in check, the GES is also responsible for logging. Al transactional events with the database should be persisted. Here are some examples:

- A Hopper updates his profile banner.
- A Hopper updates his Burrow Flair.
- A Keeper adds/removes a new Keeper to their Burrow.
- An Admin logs into the Admin panel.

#### DSI

After certain events like creation of a new Burrow or Hopper, the Meilisearch search index has to be updated, to accommodate for these new entities. The index is updated on production deployment, but also after creation events. The latter trigger comes from the GES.

A new list of all entities is compiled and sent to Meilisearch, enabling the searchbar in the navbar to be able to find the new entities.

#### SPS

> This system is skipped and will not be implemented.

With great platform comes great responsibility. Rabbit offers a lot of features, but not for everyone. Certain interactions or access to pages require special rights. Below you can find the different roles/user types in descending order of power:

- Admin, owners of the platform. They have super rights, but are unable to alter concrete content like titles and comments.
- Keeper, Burrow-scoped moderators. Able to block Hoppers and pin posts, but only within their assigned Burrow.
- Hopper, a general logged in user. Can access and interact with most of the platform. Can have different statuses changing their rights.
- Stray, a new or non-logged in user. Read-only mode. Can still access with most of the platform.

#### TSS

The task scheduling system handles timing jobs, like sending newsletters and disarming timeouts on Hoppers.

#### GMD

The mail dispatcher handles all outgoing mails to Hoppers and Keepers alike. It will be used for mails like:

- Account verification mail
- 2FA setup mail
- Notifying Keepers when their Burrow gets banned

#### CDN

The content delivery network, or CDN for short, is a media management system. Rabbit has several types of media that are uploaded, rendered and deleted daily. Think of profile pictures of Hoppers and videos of posts. The files are hosted on [files.stefankruik.com](https://files.stefankruik.com/rabbit). This server is managed by Stefan.

The name CDN implies delivery only, but in this case it is the entire flow from including uploading. So, to list the responsibilities out:

- Uploading of videos and images.
- Compressing said media to decrease file size and increase performance.
- Rendering media where it's needed. This can range from static image loading to streaming a video.
- Deletion. When a post or Hopper account is deleted, connected imagery is also cascaded.

The CDN of Stefan serves all other paths freely to the internet, but for security and privacy reasons everything after the `/rabbit` path can only be accessed by the relevant Rabbit Network sites. The following sub-folders are present to group the data:

- `/system`: System files like fine-print and such.
- `/hopper/avatar`: Profile picture of the Hopper.
- `/hopper/banner`: Banner image of the Hopper.
- `/post/video`: MP4 video files for the posts.
- `/post/image`: Image files for the posts.
- `/burrow/avatar`: Profile picture of the Burrow.
- `/burrow/banner`: Banner image of the Burrow.

#### RTD

The real time delivery network is a fancy version of a WebSocket implementation, mostly used by the notification system. Every Hopper is registered to the RTD when the app is opened. From that point, they can receive messages.

The navigationbar holds the initializer. All active Hoppers are tracked in-memory in a central place. The connection is bound to the ID of the Hopper, which results in a quick lookups when you need to send a message to a Hopper.

This does mean that when a Hopper is not online they do not have a RTD connection. Messages sent to offline Hoppers are just persisted in the database, and retrieved when logging in again. The RTD only facilitates instant delivery of payloads, it does not cover persistence. Here are some examples of RTD messages:

- Replies to your comments: `hopperName reacted to your comment in burrowName`.
- Replies to your post: `hopperName reacted to your post in` burrowName`.
- Your comment reaching a certain amount of Praises `your comment in burrowName reached XX Praises`.
- Your Buddy request being accepted
- A new Tail received
- Official messages from the system (like platform updates)

Like with anything in life, it is tightly connected to the GES. GES does most of the message triggers, that get dispatched by RTD. In some cases, an email is sent with GMD as well.
